<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>英语单词连线游戏</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f4f8;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
        }

        h1 {
            color: #2c3e50;
            margin-top: 20px;
        }

        .score-board {
            background: #fff;
            padding: 10px 20px;
            border-radius: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            font-size: 1.2em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 20px;
        }
        
        .score-num {
            color: #e67e22;
            font-size: 1.4em;
        }

        /* 游戏容器 */
        .game-container {
            position: relative;
            display: flex;
            justify-content: space-between;
            width: 600px;
            max-width: 95%;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        /* 画布层，用于画线 */
        #line-canvas {
            position: absolute;
            top: 0;
            left: 0;
            pointer-events: none; /* 让鼠标点击穿透画布作用于按钮 */
            width: 100%;
            height: 100%;
            z-index: 10;
        }

        .column {
            display: flex;
            flex-direction: column;
            gap: 30px; /* 增加间距，方便看清连线 */
            width: 35%;
            z-index: 20;
        }

        .word-item {
            background-color: #e0e7ff;
            border: 2px solid #c7d2fe;
            padding: 15px;
            text-align: center;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 18px;
            color: #333;
            user-select: none;
            position: relative;
        }

        .word-item:hover {
            background-color: #c7d2fe;
            transform: translateY(-2px);
        }

        /* 选中状态 */
        .word-item.selected {
            background-color: #3b82f6;
            color: white;
            border-color: #2563eb;
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.5);
        }

        /* 匹配成功状态 (不再消失，而是变绿并锁定) */
        .word-item.correct {
            background-color: #10b981;
            color: white;
            border-color: #059669;
            cursor: default; /* 鼠标变回默认 */
            transform: none;
        }
        
        /* 匹配成功后取消hover效果 */
        .word-item.correct:hover {
            transform: none;
            background-color: #10b981;
        }

        /* 匹配失败状态 */
        .word-item.wrong {
            background-color: #ef4444;
            color: white;
            animation: shake 0.5s;
        }

        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            50% { transform: translateX(5px); }
            75% { transform: translateX(-5px); }
            100% { transform: translateX(0); }
        }

        #message {
            margin-top: 20px;
            font-size: 1.3em;
            font-weight: bold;
            color: #2c3e50;
            height: 30px;
            text-align: center;
        }
        
        .btn-reset {
            margin-top: 20px;
            padding: 10px 20px;
            background-color: #34495e;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            display: none;
            margin-bottom: 20px;
        }
        .btn-reset:hover {
            background-color: #2c3e50;
        }

    </style>
</head>
<body>

    <h1>英语单词配对</h1>
    
    <div class="score-board">当前得分: <span id="score" class="score-num">0</span></div>
    <div id="message">请连接左侧英文和右侧中文</div>

    <div class="game-container" id="game-box">
        <canvas id="line-canvas"></canvas>
        
        <!-- 左侧英文 -->
        <div class="column" id="left-col"></div>

        <!-- 右侧中文 -->
        <div class="column" id="right-col"></div>
    </div>

    <button class="btn-reset" id="reset-btn" onclick="initGame()">再玩一次</button>

    <script>
        // 单词数据
        const wordsData = [
            { id: 1, en: 'cinema', cn: '电影院' },
            { id: 2, en: 'dentist', cn: '牙医' },
            { id: 3, en: 'supermarket', cn: '超市' },
            { id: 4, en: 'toothache', cn: '牙痛' }
        ];

        let score = 0;
        let matchedPairs = []; // 存储已匹配的DOM元素对，用于画线
        let selectedLeft = null;
        let selectedRight = null;
        let isProcessing = false; 

        const leftCol = document.getElementById('left-col');
        const rightCol = document.getElementById('right-col');
        const scoreEl = document.getElementById('score');
        const canvas = document.getElementById('line-canvas');
        const ctx = canvas.getContext('2d');
        const msgEl = document.getElementById('message');
        const resetBtn = document.getElementById('reset-btn');

        // 初始化游戏
        function initGame() {
            score = 0;
            matchedPairs = []; // 清空已匹配列表
            scoreEl.innerText = score;
            msgEl.innerText = "请点击连线";
            msgEl.style.color = "#2c3e50";
            resetBtn.style.display = 'none';
            selectedLeft = null;
            selectedRight = null;
            isProcessing = false;
            
            clearCanvas();

            // 清空容器
            leftCol.innerHTML = '';
            rightCol.innerHTML = '';

            // 准备左侧数据 (保持顺序)
            wordsData.forEach(item => {
                const div = createWordElement(item, 'en');
                leftCol.appendChild(div);
            });

            // 准备右侧数据 (随机打乱)
            const shuffledData = [...wordsData].sort(() => Math.random() - 0.5);
            shuffledData.forEach(item => {
                const div = createWordElement(item, 'cn');
                rightCol.appendChild(div);
            });

            // 确保Canvas尺寸正确
            setTimeout(resizeCanvas, 50);
        }

        function createWordElement(item, type) {
            const div = document.createElement('div');
            div.className = 'word-item';
            div.innerText = type === 'en' ? item.en : item.cn;
            div.dataset.id = item.id;
            div.dataset.type = type;
            
            div.addEventListener('click', () => handleWordClick(div));
            return div;
        }

        function handleWordClick(element) {
            // 如果正在处理，或者该元素已经匹配成功（correct），则不可点击
            if (isProcessing || element.classList.contains('correct')) return;
            
            // 如果点击的是当前已选中的，取消选中
            if (element.classList.contains('selected')) {
                element.classList.remove('selected');
                if (element.dataset.type === 'en') selectedLeft = null;
                else selectedRight = null;
                return;
            }

            // 选中逻辑
            const type = element.dataset.type;
            
            if (type === 'en') {
                if (selectedLeft) selectedLeft.classList.remove('selected');
                selectedLeft = element;
                selectedLeft.classList.add('selected');
            } else {
                if (selectedRight) selectedRight.classList.remove('selected');
                selectedRight = element;
                selectedRight.classList.add('selected');
            }

            // 检查是否配对
            if (selectedLeft && selectedRight) {
                checkMatch();
            }
        }

        function checkMatch() {
            isProcessing = true;
            const idLeft = selectedLeft.dataset.id;
            const idRight = selectedRight.dataset.id;

            if (idLeft === idRight) {
                handleSuccess();
            } else {
                handleFail();
            }
        }

        function handleSuccess() {
            // 1. 样式变更
            selectedLeft.classList.remove('selected');
            selectedRight.classList.remove('selected');
            selectedLeft.classList.add('correct');
            selectedRight.classList.add('correct');
            
            // 2. 记录配对并画线
            matchedPairs.push({
                left: selectedLeft,
                right: selectedRight
            });
            drawAllLines(); // 重绘所有线

            // 3. 重置临时变量
            selectedLeft = null;
            selectedRight = null;
            isProcessing = false;
            
            msgEl.innerText = "配对正确！";

            // 4. 检查是否全部完成
            if (matchedPairs.length === wordsData.length) {
                gameWin();
            }
        }

        function handleFail() {
            selectedLeft.classList.add('wrong');
            selectedRight.classList.add('wrong');
            msgEl.innerText = "配对错误";

            setTimeout(() => {
                selectedLeft.classList.remove('selected', 'wrong');
                selectedRight.classList.remove('selected', 'wrong');
                selectedLeft = null;
                selectedRight = null;
                isProcessing = false;
                msgEl.innerText = "请继续连线";
            }, 500);
        }

        function gameWin() {
            // 游戏结束时才计算分数
            // 比如每对10分
            score = matchedPairs.length * 10; 
            
            // 动画显示分数
            let tempScore = 0;
            const timer = setInterval(() => {
                tempScore++;
                scoreEl.innerText = tempScore;
                if(tempScore >= score) clearInterval(timer);
            }, 50);

            msgEl.innerText = "恭喜！全部匹配完成！";
            msgEl.style.color = "#16a085";
            resetBtn.style.display = 'block';
        }

        // 画所有的线
        function drawAllLines() {
            clearCanvas();
            matchedPairs.forEach(pair => {
                drawLine(pair.left, pair.right, '#10b981');
            });
        }

        // 画单条线逻辑
        function drawLine(el1, el2, color) {
            if (!el1 || !el2) return;
            
            const rect1 = el1.getBoundingClientRect();
            const rect2 = el2.getBoundingClientRect();
            const containerRect = document.getElementById('game-box').getBoundingClientRect();

            // 计算连接点：左边元素的右侧中点，连到右边元素的左侧中点
            // x1: 左列元素的右边界
            // x2: 右列元素的左边界
            const x1 = (rect1.left - containerRect.left) + rect1.width; 
            const y1 = (rect1.top - containerRect.top) + rect1.height / 2;
            
            const x2 = (rect2.left - containerRect.left);
            const y2 = (rect2.top - containerRect.top) + rect2.height / 2;

            ctx.beginPath();
            ctx.moveTo(x1, y1);
            
            // 贝塞尔曲线让连线更平滑好看（可选），这里用直线简单明了
            // ctx.bezierCurveTo(x1 + 50, y1, x2 - 50, y2, x2, y2);
            ctx.lineTo(x2, y2);

            ctx.strokeStyle = color;
            ctx.lineWidth = 4;
            ctx.lineCap = 'round';
            ctx.stroke();
        }

        function clearCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }

        function resizeCanvas() {
            const container = document.getElementById('game-box');
            canvas.width = container.offsetWidth;
            canvas.height = container.offsetHeight;
            // 调整大小时重绘已经存在的线
            drawAllLines();
        }

        // 监听窗口大小改变
        window.addEventListener('resize', resizeCanvas);

        // 启动
        initGame();

    </script>
</body>
</html>
