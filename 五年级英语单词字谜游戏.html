<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äº”å¹´çº§è‹±è¯­å•è¯å¯»å®</title>
    <!-- å¼•å…¥æ’’èŠ±ç‰¹æ•ˆåº“ -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f8ff;
            display: flex;
            flex-direction: column;
            align-items: center;
            user-select: none;
        }

        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        /* è§„åˆ™åŒºåŸŸæ ·å¼ */
        #rules {
            background-color: #fff;
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            max-width: 600px;
            width: 90%;
            text-align: left; /* é å·¦å¯¹é½ */
            margin-bottom: 20px;
            border-left: 5px solid #3498db;
            line-height: 1.6;
            color: #333;
            font-size: 16px;
        }

        .game-area {
            display: flex;
            gap: 20px;
            align-items: flex-start;
        }

        #grid-container {
            display: grid;
            grid-template-columns: repeat(10, 40px);
            grid-template-rows: repeat(10, 40px);
            gap: 2px;
            background-color: #333;
            padding: 5px;
            border-radius: 5px;
            cursor: pointer;
        }

        .cell {
            width: 40px;
            height: 40px;
            background-color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 20px;
            font-weight: bold;
            color: #333;
            text-transform: uppercase;
        }

        .cell.selected {
            background-color: #87ceeb;
        }

        @keyframes flashAnim {
            0% { background-color: #2ecc71; transform: scale(1); }
            50% { background-color: #f1c40f; transform: scale(1.2); }
            100% { background-color: #2ecc71; transform: scale(1); }
        }

        .cell.found {
            background-color: #2ecc71;
            color: white;
            animation: flashAnim 0.5s ease-in-out;
        }

        #sidebar {
            background-color: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            min-width: 150px;
        }

        #sidebar h3 {
            margin-top: 0;
            margin-bottom: 10px;
            color: #e67e22;
            text-align: center;
            font-size: 18px;
        }

        /* å•è¯åˆ—è¡¨é¡¹æ ·å¼ */
        .word-item {
            font-size: 18px;
            margin: 8px 0;
            padding: 8px;
            border-radius: 5px;
            text-align: center;
            transition: all 0.3s ease;
            letter-spacing: 1px;
        }

        /* æœªæ‰¾åˆ°æ—¶çš„ç©ºä½æ ·å¼ */
        .word-item.empty {
            background-color: #f0f0f0;
            color: #bbb;
            border: 2px dashed #ccc;
            font-family: monospace;
        }

        /* æ‰¾åˆ°åçš„æ ·å¼ */
        .word-item.revealed {
            background-color: #e8f8f5;
            border: 2px solid #2ecc71;
            color: #27ae60;
            font-weight: bold;
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes popIn {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        #count-info {
            margin-top: 15px;
            font-weight: bold;
            color: #c0392b;
            text-align: center;
            font-size: 14px;
        }
        
        @media (max-width: 600px) {
            .game-area {
                flex-direction: column;
                align-items: center;
            }
            #grid-container {
                grid-template-columns: repeat(10, 32px);
                grid-template-rows: repeat(10, 32px);
            }
            .cell {
                width: 32px;
                height: 32px;
                font-size: 16px;
            }
            #sidebar {
                width: 100%;
                max-width: 300px;
            }
        }
    </style>
</head>
<body>

    <h1>ğŸ‡¬ğŸ‡§ å•è¯å¯»å®å¤§å†’é™©</h1>

    <!-- ä¿®æ”¹éƒ¨åˆ†ï¼šä¸¥æ ¼æŒ‰ç…§æ‚¨çš„è¦æ±‚æ›´æ–°è§„åˆ™æ–‡æœ¬ -->
    <div id="rules">
        <strong>æ¸¸æˆè§„åˆ™ï¼š</strong><br>
        1. æ¨ªå‘æˆ–çºµå‘é€‰æ‹©å­—æ¯ï¼Œæ‰¾éšè—çš„å•è¯ã€‚<br>
        2. å…±æœ‰5ä¸ªå…³äºâ€œè¡£ç‰©â€çš„å•è¯ï¼Œå¿«æŠŠå®ƒä»¬éƒ½æ‰¾å‡ºæ¥å§ï¼
    </div>

    <div class="game-area">
        <!-- æ¸¸æˆç½‘æ ¼ -->
        <div id="grid-container"></div>

        <!-- ä¾§è¾¹æ  -->
        <div id="sidebar">
            <h3>ğŸ“‹ ä»»åŠ¡åˆ—è¡¨</h3>
            <div id="word-list">
                <!-- JSåŠ¨æ€ç”Ÿæˆ -->
            </div>
            <div id="count-info">å‰©ä½™: <span id="remaining-count">5</span> ä¸ª</div>
        </div>
    </div>

    <script>
        // æ¸¸æˆé…ç½®
        const gridSize = 10;
        const targetWords = ["CLOTHES", "PANTS", "SCARF", "HAT", "SHIRT"];
        let grid = [];
        let foundWords = [];
        
        // DOM å…ƒç´ 
        const gridContainer = document.getElementById('grid-container');
        const wordListEl = document.getElementById('word-list');
        const remainingCountEl = document.getElementById('remaining-count');

        // äº¤äº’çŠ¶æ€
        let isSelecting = false;
        let startCell = null;
        let currentSelection = [];

        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            createGridData();
            placeWords();
            fillEmptyCells();
            renderGrid();
            renderSidebar(); 
            setupEvents();
        }

        function createGridData() {
            grid = new Array(gridSize).fill(null).map(() => new Array(gridSize).fill(''));
        }

        function placeWords() {
            // æ‰“ä¹±é¡ºåºï¼Œç¡®ä¿æ¯æ¬¡é‡æ–°å¼€å§‹æ—¶ï¼Œå…·ä½“çš„å•è¯æ–¹å‘ï¼ˆæ¨ª/ç«–ï¼‰ä¸åŒ
            const shuffledWords = [...targetWords].sort(() => Math.random() - 0.5);

            shuffledWords.forEach((word, index) => {
                let placed = false;
                let attempts = 0;
                while (!placed && attempts < 200) {
                    // å¼ºåˆ¶äº¤æ›¿æ–¹å‘ï¼šå¶æ•°ç´¢å¼•æ¨ªå‘ï¼Œå¥‡æ•°ç´¢å¼•çºµå‘ï¼Œç¡®ä¿ä¸å…¨æ˜¯æ¨ªå‘
                    const direction = index % 2; 
                    
                    const row = Math.floor(Math.random() * gridSize);
                    const col = Math.floor(Math.random() * gridSize);

                    if (canPlace(word, row, col, direction)) {
                        place(word, row, col, direction);
                        placed = true;
                    }
                    attempts++;
                }
                // å…œåº•é€»è¾‘ï¼šå¦‚æœäº¤æ›¿æ”¾ç½®å¤±è´¥ï¼Œå°è¯•éšæœºæ–¹å‘
                if (!placed) {
                    const fallbackDir = Math.random() > 0.5 ? 0 : 1;
                    for(let i=0; i<100; i++) {
                        const r = Math.floor(Math.random() * gridSize);
                        const c = Math.floor(Math.random() * gridSize);
                        if (canPlace(word, r, c, fallbackDir)) {
                            place(word, r, c, fallbackDir);
                            break;
                        }
                    }
                }
            });
        }

        function canPlace(word, row, col, direction) {
            if (direction === 0) { // æ¨ªå‘
                if (col + word.length > gridSize) return false;
                for (let i = 0; i < word.length; i++) {
                    if (grid[row][col + i] !== '' && grid[row][col + i] !== word[i]) return false;
                }
            } else { // çºµå‘
                if (row + word.length > gridSize) return false;
                for (let i = 0; i < word.length; i++) {
                    if (grid[row + i][col] !== '' && grid[row + i][col] !== word[i]) return false;
                }
            }
            return true;
        }

        function place(word, row, col, direction) {
            for (let i = 0; i < word.length; i++) {
                if (direction === 0) {
                    grid[row][col + i] = word[i];
                } else {
                    grid[row + i][col] = word[i];
                }
            }
        }

        function fillEmptyCells() {
            const letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
            for (let r = 0; r < gridSize; r++) {
                for (let c = 0; c < gridSize; c++) {
                    if (grid[r][c] === '') {
                        grid[r][c] = letters.charAt(Math.floor(Math.random() * letters.length));
                    }
                }
            }
        }

        function renderGrid() {
            gridContainer.innerHTML = '';
            for (let r = 0; r < gridSize; r++) {
                for (let c = 0; c < gridSize; c++) {
                    const cell = document.createElement('div');
                    cell.classList.add('cell');
                    cell.dataset.row = r;
                    cell.dataset.col = c;
                    cell.textContent = grid[r][c];
                    gridContainer.appendChild(cell);
                }
            }
        }

        function renderSidebar() {
            wordListEl.innerHTML = '';
            targetWords.forEach(word => {
                const item = document.createElement('div');
                item.classList.add('word-item', 'empty');
                item.id = 'slot-' + word; 
                item.textContent = '?????'; 
                wordListEl.appendChild(item);
            });
        }

        function setupEvents() {
            gridContainer.addEventListener('mousedown', handleStart);
            gridContainer.addEventListener('mouseover', handleMove);
            document.addEventListener('mouseup', handleEnd);
            
            // ç®€å•çš„è§¦æ‘¸æ”¯æŒ
            gridContainer.addEventListener('touchstart', (e) => {
                e.preventDefault();
                handleStart(e.touches[0]);
            }, {passive: false});
        }

        function handleStart(e) {
            let target = document.elementFromPoint(e.clientX, e.clientY);
            if (!target || !target.classList.contains('cell')) return;
            
            isSelecting = true;
            startCell = target;
            updateSelection(startCell);
        }

        function handleMove(e) {
            if (!isSelecting) return;
            let target = e.target; 
            if(!target.classList.contains('cell')) return;
            updateSelection(target);
        }

        function updateSelection(endCell) {
            document.querySelectorAll('.cell.selected').forEach(el => el.classList.remove('selected'));
            
            const r1 = parseInt(startCell.dataset.row);
            const c1 = parseInt(startCell.dataset.col);
            const r2 = parseInt(endCell.dataset.row);
            const c2 = parseInt(endCell.dataset.col);

            currentSelection = [];

            if (r1 === r2) {
                // æ¨ªå‘
                const start = Math.min(c1, c2);
                const end = Math.max(c1, c2);
                for (let i = start; i <= end; i++) {
                    const cell = document.querySelector(`.cell[data-row="${r1}"][data-col="${i}"]`);
                    cell.classList.add('selected');
                    currentSelection.push(cell);
                }
            } else if (c1 === c2) {
                // çºµå‘
                const start = Math.min(r1, r2);
                const end = Math.max(r1, r2);
                for (let i = start; i <= end; i++) {
                    const cell = document.querySelector(`.cell[data-row="${i}"][data-col="${c1}"]`);
                    cell.classList.add('selected');
                    currentSelection.push(cell);
                }
            }
        }

        function handleEnd() {
            if (!isSelecting) return;
            isSelecting = false;
            let selectedWord = currentSelection.map(cell => cell.textContent).join('');
            checkWord(selectedWord);
            document.querySelectorAll('.cell.selected').forEach(el => el.classList.remove('selected'));
        }

        function checkWord(word) {
            if (targetWords.includes(word) && !foundWords.includes(word)) {
                successFound(word);
            }
        }

        function successFound(word) {
            foundWords.push(word);
            
            // 1. æ’­æ”¾è¯»éŸ³
            speakWord(word);

            // 2. ç½‘æ ¼å˜è‰²
            currentSelection.forEach(cell => {
                cell.classList.add('found');
            });

            // 3. å¡«å……ä¾§è¾¹æ 
            const slot = document.getElementById('slot-' + word);
            if (slot) {
                slot.textContent = word.toLowerCase(); 
                slot.classList.remove('empty'); 
                slot.classList.add('revealed'); 
            }
            
            remainingCountEl.textContent = targetWords.length - foundWords.length;

            if (foundWords.length === targetWords.length) {
                setTimeout(celebrate, 500);
            }
        }

        function speakWord(text) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'en-US';
                utterance.rate = 0.8;
                window.speechSynthesis.speak(utterance);
            }
        }

        function celebrate() {
            const endMsg = new SpeechSynthesisUtterance("Congratulations!");
            endMsg.lang = 'en-US';
            window.speechSynthesis.speak(endMsg);

            const duration = 3000;
            const end = Date.now() + duration;

            (function frame() {
                confetti({
                    particleCount: 5,
                    angle: 60,
                    spread: 55,
                    origin: { x: 0 }
                });
                confetti({
                    particleCount: 5,
                    angle: 120,
                    spread: 55,
                    origin: { x: 1 }
                });

                if (Date.now() < end) {
                    requestAnimationFrame(frame);
                }
            }());
            
            setTimeout(() => {
                alert("æ­å–œï¼æŒ‘æˆ˜æˆåŠŸï¼ğŸ‰");
            }, 500);
        }

        initGame();

    </script>
</body>
</html>
